import{_ as y,c as n,a as e,b as a,F as d,r as m,t as l,w as k,e as c,v as p,d as S,o as u,n as f}from"./index-CkUboUl1.js";const h={name:"StockView",data(){return{stock:[],error:"",restockType:"cafe",restockSubtype:"gateau",restockQuantity:1,restockReason:"",restockError:"",restockSuccess:!1}},computed:{isAdmin(){return JSON.parse(localStorage.getItem("user")||"{}").role==="admin"}},methods:{async fetchStock(){this.error="";try{const o=localStorage.getItem("token"),t=await fetch("/stock",{headers:{Authorization:o?`Bearer ${o}`:""}});if(!t.ok){this.error="Erreur lors de la récupération du stock.";return}this.stock=await t.json()}catch{this.error="Erreur réseau ou serveur."}},formatDate(o){return o?new Date(o).toLocaleDateString():"-"},stockClass(o){return o.quantity<=0?"stock-empty":o.quantity<o.threshold?"stock-low":"stock-ok"},async restock(){if(this.restockError="",this.restockSuccess=!1,this.restockQuantity<1){this.restockError="Quantité invalide.";return}try{const o=localStorage.getItem("token");if(!(await fetch("/stock/restock",{method:"POST",headers:{"Content-Type":"application/json",Authorization:o?`Bearer ${o}`:""},body:JSON.stringify({type:this.restockType,subtype:this.restockType==="nourriture"?this.restockSubtype:null,quantity:this.restockQuantity,reason:this.restockReason})})).ok){this.restockError="Erreur lors du réapprovisionnement.";return}this.restockSuccess=!0,this.fetchStock(),this.restockQuantity=1,this.restockReason=""}catch{this.restockError="Erreur réseau ou serveur."}}},mounted(){this.fetchStock()}},v={class:"stock-container"},b={key:0,class:"error"},g={key:1,class:"admin-stock"},E={key:0},T={key:0,class:"error"},w={key:1,class:"success"};function Q(o,t,V,R,s,i){return u(),n("div",v,[t[14]||(t[14]=e("h2",null,"Stock actuel",-1)),e("table",null,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"Type"),e("th",null,"Sous-type"),e("th",null,"Quantité"),e("th",null,"Seuil"),e("th",null,"Dernier réappro.")])],-1)),e("tbody",null,[(u(!0),n(d,null,m(s.stock,r=>(u(),n("tr",{key:r.id,class:f(i.stockClass(r))},[e("td",null,l(r.type),1),e("td",null,l(r.subtype||"-"),1),e("td",null,l(r.quantity),1),e("td",null,l(r.threshold),1),e("td",null,l(i.formatDate(r.lastRestocked)),1)],2))),128))])]),s.error?(u(),n("p",b,l(s.error),1)):a("",!0),i.isAdmin?(u(),n("div",g,[t[13]||(t[13]=e("h3",null,"Réapprovisionnement",-1)),e("form",{onSubmit:t[4]||(t[4]=S((...r)=>i.restock&&i.restock(...r),["prevent"]))},[t[9]||(t[9]=e("label",null,"Type :",-1)),k(e("select",{"onUpdate:modelValue":t[0]||(t[0]=r=>s.restockType=r),required:""},[...t[6]||(t[6]=[e("option",{value:"cafe"},"Café",-1),e("option",{value:"the"},"Thé",-1),e("option",{value:"nourriture"},"Nourriture",-1)])],512),[[c,s.restockType]]),s.restockType==="nourriture"?(u(),n("div",E,[t[8]||(t[8]=e("label",null,"Sous-type :",-1)),k(e("select",{"onUpdate:modelValue":t[1]||(t[1]=r=>s.restockSubtype=r),required:""},[...t[7]||(t[7]=[e("option",{value:"gateau"},"Gâteau",-1),e("option",{value:"viennoiserie"},"Viennoiserie",-1),e("option",{value:"autre"},"Autre",-1)])],512),[[c,s.restockSubtype]])])):a("",!0),t[10]||(t[10]=e("label",null,"Quantité à ajouter :",-1)),k(e("input",{"onUpdate:modelValue":t[2]||(t[2]=r=>s.restockQuantity=r),type:"number",min:"1",required:""},null,512),[[p,s.restockQuantity,void 0,{number:!0}]]),t[11]||(t[11]=e("label",null,"Commentaire :",-1)),k(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>s.restockReason=r),type:"text",placeholder:"Optionnel"},null,512),[[p,s.restockReason]]),t[12]||(t[12]=e("button",{type:"submit"},"Réapprovisionner",-1))],32),s.restockError?(u(),n("p",T,l(s.restockError),1)):a("",!0),s.restockSuccess?(u(),n("p",w,"Stock mis à jour !")):a("",!0)])):a("",!0)])}const C=y(h,[["render",Q],["__scopeId","data-v-1b68ec7e"]]);export{C as default};
