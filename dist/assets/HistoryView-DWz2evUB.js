import{_ as f,c as u,a as t,b as y,w as d,e as m,v as b,d as k,F as h,r as p,t as o,o as i}from"./index-CkUboUl1.js";const v={name:"HistoryView",data(){return{history:[],allHistory:[],filterType:"",filterDate:"",error:""}},computed:{isAdmin(){return JSON.parse(localStorage.getItem("user")||"{}").role==="admin"}},methods:{async fetchHistory(){this.error="";try{const l=localStorage.getItem("token");let e="/purchases/me?";this.filterType&&(e+=`type=${this.filterType}&`),this.filterDate&&(e+=`date=${this.filterDate}`);const a=await fetch(e,{headers:{Authorization:l?`Bearer ${l}`:""}});if(!a.ok){this.error="Erreur lors de la récupération de l'historique.";return}this.history=await a.json()}catch{this.error="Erreur réseau ou serveur."}},async fetchAllHistory(){this.error="";try{const l=localStorage.getItem("token"),e=await fetch("/purchases",{headers:{Authorization:l?`Bearer ${l}`:""}});if(!e.ok){this.error="Erreur lors de la récupération de l'historique global.";return}this.allHistory=await e.json()}catch{this.error="Erreur réseau ou serveur."}},formatDate(l){return l?new Date(l).toLocaleString():"-"}},mounted(){this.fetchHistory()}},D={class:"history-container"},c={key:0,class:"error"},H={key:1,class:"admin-history"},g={key:0};function T(l,e,a,w,s,n){return i(),u("div",D,[e[11]||(e[11]=t("h2",null,"Mon historique d'achats",-1)),t("form",{class:"filters",onSubmit:e[2]||(e[2]=k((...r)=>n.fetchHistory&&n.fetchHistory(...r),["prevent"]))},[e[5]||(e[5]=t("label",null,"Type :",-1)),d(t("select",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.filterType=r)},[...e[4]||(e[4]=[t("option",{value:""},"Tous",-1),t("option",{value:"cafe"},"Café",-1),t("option",{value:"the"},"Thé",-1),t("option",{value:"nourriture"},"Nourriture",-1)])],512),[[m,s.filterType]]),e[6]||(e[6]=t("label",null,"Date :",-1)),d(t("input",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.filterDate=r),type:"date"},null,512),[[b,s.filterDate]]),e[7]||(e[7]=t("button",{type:"submit"},"Filtrer",-1))],32),t("table",null,[e[8]||(e[8]=t("thead",null,[t("tr",null,[t("th",null,"Date"),t("th",null,"Type"),t("th",null,"Sous-type"),t("th",null,"Quantité")])],-1)),t("tbody",null,[(i(!0),u(h,null,p(s.history,r=>(i(),u("tr",{key:r.id},[t("td",null,o(n.formatDate(r.timestamp)),1),t("td",null,o(r.type),1),t("td",null,o(r.subtype||"-"),1),t("td",null,o(r.quantity),1)]))),128))])]),s.error?(i(),u("p",c,o(s.error),1)):y("",!0),n.isAdmin?(i(),u("div",H,[e[10]||(e[10]=t("h3",null,"Vue globale (admin)",-1)),t("button",{onClick:e[3]||(e[3]=(...r)=>n.fetchAllHistory&&n.fetchAllHistory(...r))},"Voir tout l'historique"),s.allHistory.length?(i(),u("table",g,[e[9]||(e[9]=t("thead",null,[t("tr",null,[t("th",null,"Utilisateur"),t("th",null,"Date"),t("th",null,"Type"),t("th",null,"Sous-type"),t("th",null,"Quantité")])],-1)),t("tbody",null,[(i(!0),u(h,null,p(s.allHistory,r=>(i(),u("tr",{key:r.id},[t("td",null,o(r.userEmail),1),t("td",null,o(n.formatDate(r.timestamp)),1),t("td",null,o(r.type),1),t("td",null,o(r.subtype||"-"),1),t("td",null,o(r.quantity),1)]))),128))])])):y("",!0)])):y("",!0)])}const V=f(v,[["render",T],["__scopeId","data-v-74b251dc"]]);export{V as default};
