import{_ as c,c as u,a as t,b as p,w as y,e as d,v as h,d as m,t as f,o as i,f as v,g as b}from"./index-CkUboUl1.js";const g={name:"PurchaseForm",data(){return{type:"cafe",subtype:"gateau",quantity:1,error:"",success:!1}},methods:{onTypeChange(){this.type!=="nourriture"&&(this.subtype="")},async submitPurchase(){this.error="",this.success=!1;const l=["cafe","the","nourriture"],e=["gateau","viennoiserie","autre"];if(!l.includes(this.type)){this.error="Type invalide.";return}if(this.type==="nourriture"&&!e.includes(this.subtype)){this.error="Sous-type invalide.";return}if(this.quantity<1||this.quantity>5){this.error="Quantité invalide (1 à 5).";return}try{const n=localStorage.getItem("token"),a=await fetch("/purchases",{method:"POST",headers:{"Content-Type":"application/json",Authorization:n?`Bearer ${n}`:""},body:JSON.stringify({type:this.type,subtype:this.type==="nourriture"?this.subtype:null,quantity:this.quantity})});if(!a.ok){const r=await a.json();this.error=r.message||"Erreur lors de l'achat";return}this.success=!0,this.type="cafe",this.subtype="gateau",this.quantity=1}catch{this.error="Erreur réseau ou serveur."}}}},q={class:"purchase-container"},P={key:0},T={key:0,class:"error"},V={key:1,class:"success"};function w(l,e,n,a,r,o){return i(),u("div",q,[e[11]||(e[11]=t("h2",null,"Enregistrer un achat",-1)),t("form",{onSubmit:e[4]||(e[4]=m((...s)=>o.submitPurchase&&o.submitPurchase(...s),["prevent"]))},[e[8]||(e[8]=t("label",null,"Type :",-1)),y(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>r.type=s),onChange:e[1]||(e[1]=(...s)=>o.onTypeChange&&o.onTypeChange(...s)),required:""},[...e[5]||(e[5]=[t("option",{value:"cafe"},"Café",-1),t("option",{value:"the"},"Thé",-1),t("option",{value:"nourriture"},"Nourriture",-1)])],544),[[d,r.type]]),r.type==="nourriture"?(i(),u("div",P,[e[7]||(e[7]=t("label",null,"Sous-type :",-1)),y(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>r.subtype=s),required:""},[...e[6]||(e[6]=[t("option",{value:"gateau"},"Gâteau",-1),t("option",{value:"viennoiserie"},"Viennoiserie",-1),t("option",{value:"autre"},"Autre Nourriture",-1)])],512),[[d,r.subtype]])])):p("",!0),e[9]||(e[9]=t("label",null,"Quantité :",-1)),y(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>r.quantity=s),type:"number",min:"1",max:"5",required:""},null,512),[[h,r.quantity,void 0,{number:!0}]]),e[10]||(e[10]=t("button",{type:"submit"},"Valider",-1))],32),r.error?(i(),u("p",T,f(r.error),1)):p("",!0),r.success?(i(),u("p",V,"Achat enregistré !")):p("",!0)])}const S=c(g,[["render",w],["__scopeId","data-v-868866c7"]]),k={name:"PurchaseView",components:{PurchaseForm:S}};function C(l,e,n,a,r,o){const s=b("PurchaseForm");return i(),u("div",null,[v(s)])}const N=c(k,[["render",C]]);export{N as default};
